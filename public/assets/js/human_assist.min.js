$(function(){function e(a){var b=$("#message"),c=$(' <div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+a+" </div>");b.append(c)}function f(a){var b=$("#message"),c=$('<div class="alert alert-success" role="alert">'+a+"</div>");b.append(c)}function f(a){var b=$(".alert-success");b.remove()}function h(a){return!(!a||a.length<=0)||(e("Error: must include message!"),!1)}function i(){var b=$("#btn-input").val();if(h(b)){f("Sending...");var d={message:b};k(b),$.ajax({type:"POST",url:a.BASE_URL,processData:!1,contentType:"application/json",data:JSON.stringify(d),success:function(a){l(a.message)},error:function(a){e("Failed to send message.")}})}}function k(a){var b=$(".chat"),c=new Date,d=c.getHours(),e=c.getMinutes(),f=d>12?d-12+":"+e+" PM":d+":"+e+" AM",g=$('<li class="left clearfix"><span class="chat-img pull-left">  <img src="http://placehold.it/50/55C1E7/fff&text=U" alt="User Avatar" class="img-circle" /></span><div class="chat-body clearfix"><div class="header"><strong class="primary-font">You</strong> <small class="pull-right text-muted"><span class="glyphicon glyphicon-time"></span>'+f+"</small></div><p>"+a+"</p></div></li>");b.append(g)}function l(a){var b=$(".chat"),c=new Date,d=c.getHours(),e=c.getMinutes(),f=d>12?d-12+":"+e+" PM":d+":"+e+" AM",g=$('<li class="right clearfix"><span class="chat-img pull-right">  <img src="http://placehold.it/50/FA6F57/fff&text=JS" alt="User Avatar" class="img-circle" /></span><div class="chat-body clearfix"><div class="header"><small class=" text-muted"><span class="glyphicon glyphicon-time"></span>'+f+'</small><strong class="pull-right primary-font">Jack Sparrow</strong></div>  <p>'+a+"</p></div></li>");b.append(g)}function n(){}function o(){$("body").append("<div class='container'><div class='row'><div class='col-md-5' id='humanAssistPanel'></div></div></div>");var a=$("#humanAssistPanel");a.append('<div class="panel panel-primary"><div class="panel-heading" id="accordion"><span class="glyphicon glyphicon-comment"></span> Chat<div class="btn-group pull-right"><a type="button" class="btn btn-default btn-xs" data-toggle="collapse" data-parent="#accordion" href="#collapseOne"><span class="glyphicon glyphicon-chevron-down"></span></a></div></div>  ');var b=$('<div class="panel-collapse collapse" id="collapseOne"> </div>');a.append(b);var c=$("#collapseOne"),d=$('<div class="panel-body"><ul class="chat"> </ul></div>');c.append(d);var f=($(".chat"),"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornaredolor, quis ullamcorper ligula sodales.");k(f),l(f);var g=$('<div class="panel-footer"><div class="input-group"><input id="btn-input" type="text" class="form-control input-sm" placeholder="Type your message here..." /><span class="input-group-btn"><button class="btn btn-warning btn-sm" id="btn-chat">  Send</button></span></div>  </div>');c.append(g);var h=$("#btn-chat");h.click(i);var j=$("<div id='message'></div>");$(".panel-footer").append(j)}function p(a,b,d,e){var f=window.getSelection();f.removeAllRanges();var g=document.createRange(),h=$("#"+a).contents().filter(function(){return 3===this.nodeType})[0],i=$("#"+d).contents().filter(function(){return 3===this.nodeType})[0];g.setStart(h,b),g.setEnd(i,e),c=g,u()}function q(a){c=a.cloneRange(),d={startNode:c.startContainer.parentNode.id,endNode:c.endContainer.parentNode.id,startOffset:c.startOffset,endOffset:c.endOffset},s()}function r(){$("#askboxButton").css("bottom","15px"),c=null,d=null}function s(){if(c){var a=c.getClientRects();if(!a||0==a.length)return;var b=$("#askboxButton"),d=a[a.length-1].bottom,e=window.innerHeight-d;b.css("bottom",e)}}function t(a){var b=a.commonAncestorContainer,c=[];if(a.startContainer!=b)for(var d=a.startContainer;d!=b;d=d.parentNode)c.push(d);var e=[];if(c.length>0)for(var d=0;d<c.length;d++){var f=document.createRange();d?(f.setStartAfter(c[d-1]),f.setEndAfter(c[d].lastChild)):(f.setStart(c[d],a.startOffset),f.setEndAfter(c[d].nodeType==Node.TEXT_NODE?c[d]:c[d].lastChild)),e.push(f)}var g=[];if(a.endContainer!=b)for(var d=a.endContainer;d!=b;d=d.parentNode)g.push(d);var h=[];if(g.length>0)for(var d=0;d<g.length;d++){var f=document.createRange();d?(f.setStartBefore(g[d].firstChild),f.setEndBefore(g[d-1])):(f.setStartBefore(g[d].nodeType==Node.TEXT_NODE?g[d]:g[d].firstChild),f.setEnd(g[d],a.endOffset)),h.unshift(f)}var i=null;return c.length>0&&g.length>0?(i=document.createRange(),i.setStartAfter(c[c.length-1]),i.setEndBefore(g[g.length-1]),e.push(i),e.concat(h)):[a]}function u(){for(var a=t(c.cloneRange()),b=0;b<a.length;b++)if(window.getSelection().removeAllRanges(),!a[b].collapsed)if(3===a[b].startContainer.nodeType||3===a[b].endContainer.nodeType){var d=document.createElement("span");d.setAttribute("class","askboxHighlight"),a[b].surroundContents(d)}else{var d=document.createElement("div");d.setAttribute("class","askboxHighlight"),a[b].surroundContents(d)}}function w(b){if(1==b.which){if($("#askboxPanel").is(":visible"))return!1;var c=null;try{c=window.getSelection().getRangeAt(0)}catch(a){return}if(a.restrict&&(0==$(c.startContainer.parentNode).closest(a.restrict).length||0==$(c.endContainer.parentNode).closest(a.restrict).length))return void r();if(c.startContainer==c.endContainer&&c.startOffset==c.endOffset)return void r();if(!c.getClientRects)return;q(c)}}function x(){for(var b,c,d,e,a=window.location.search.substring(1).split("&"),f=0;f<a.length;f++){var g=a[f].indexOf("=");if(g!=-1){var h=a[f].substring(0,g),i=decodeURI(a[f].substring(g+1,a[f].length));switch(h){case"abSN":b=i;break;case"abSO":c=i;break;case"abEN":d=i;break;case"abEO":e=i}}}b&&c&&d&&e&&p(b,c,d,e)}function y(){$(document).mouseup(w),$(window).scroll(s)}function z(){var a=0;$("div:not([id])").each(function(){$(this).attr("id","abDiv"+a++)}),$("p:not([id])").each(function(){$(this).attr("id","abP"+a++)}),$("span:not([id])").each(function(){$(this).attr("id","abSpan"+a++)}),$("li:not([id])").each(function(){$(this).attr("id","abLi"+a++)})}function A(){$("script").each(function(c){var d=$(this).attr("src");if(d&&d.includes("askbox.js")){if(b=d.replace(/askbox\.js.*/,""),d.indexOf("?"))for(var f=d.replace(/.*\?/,""),g=f.split("&"),h=0;h<g.length;h++){var i=g[h].split("=");switch(i[0]){case"restrict":"false"==i[1]?a.restrict=!1:a.restrict=decodeURIComponent(i[1]);break;case"channel":a.channel=decodeURIComponent(i[1]);break;case"slackurl":a.BASE_URL=decodeURIComponent(i[1])}}}});var c=".chat{list-style:none;margin:0;padding:0}.chat li{margin-bottom:10px;padding-bottom:5px;border-bottom:1px dotted #B3A9A9}.chat li.left .chat-body{margin-left:60px}.chat li.right .chat-body{margin-right:60px}.chat li .chat-body p{margin:0;color:#777}.chat .glyphicon,.panel .slidedown .glyphicon{margin-right:5px}.panel-body{overflow-y:scroll;height:250px}::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#F5F5F5}::-webkit-scrollbar{width:12px;background-color:#F5F5F5}::-webkit-scrollbar-thumb{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#555}#humanAssistPanel{position:fixed;bottom:0;right:0}#humanAssistPanel .panel-primary{margin:0;border-bottom-left-radius:0;border-bottom-right-radius:0}#humanAssistPanel .panel-collapse{border:1px solid #ddd}#humanAssistPanel .alert{margin:10px 0 0;padding:5px 10px;border-radius:2px;font-size:12px}.user-typing{color:#ccc;font-size:inherit}";$("head").append('<style type="text/css">'+c+"</style>"),$("head").append($('<link rel="stylesheet" type="text/css" />').attr("href","//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"))}var a={BASE_URL:"http://130.211.159.222:5000/webhook",channel:"#our-channel",restrict:".askable"},b="",c=null,d=null;A(),z(),n(),o(),y(),x()});
